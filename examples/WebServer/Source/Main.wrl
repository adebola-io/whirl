module Main;

use Core.Http.{ Server, Response, Request };
use Core.Io.{ Fmt, Print };

public function Main() {
    app := new Server("main-app", 8080);

    app.Get("/hello", Greeting);

    welcomeMessage := Fmt("%s server is listening on port %d")
        .Fill(app.name)
        .Fill(app.port)
        .Finish()!;

    app.Start()
      .Then(fn() Print(welcomeMessage))
      .Run()
      .Await()!;
}

/// Handler function for the `/hello` endpoint.
async function Greeting(request: Request): Outcome<Response> {
    return Ok(
        *Response
            .From(request)
            .Status(200)
            .Html("<h1>Hello, world!</h1>")
    );
}