module Main;

use Core.Http.{ Server, Response, Request, ServerError };
use Core.Io.{ Format, Print };

public function Main() {
    name := "simple-server";  
    port := 8080;
    app: Server := new Server(name, port);

    printMessage := fn() Print(name + " is listening on port " + port.ToStr());

    app.Get("/hello", Greeting);


    app.Start()
      .Then(printMessage)
      .Run()
      .Await();
}

/// Handler function for the `/hello` endpoint.
async function Greeting(request: Request): Outcome<Response, ServerError> {
    return Ok(
        *Response
            .From(request)
            .Status(200)
            .Html("<h1>Hello, world!</h1>")
    );
}