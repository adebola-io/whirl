module Main;

use Core.Http.{Server, ServerOutcome, Response, Request, Middleware};
use Core.Async.ToSync;
use Core.Io.Print;

/// Entry into the program. 
public function Main() {
    name := "simple-server";
    port := 8080;
    app := new Server(name, port); 
    middleware := new Middleware();
    app.UseMiddleware(middleware);
    // routes.
    app.Get("/hello", Greeting);
    app.Get("/user/create", CreateUser); 
    prospect := app.Start()
        .Then(fn() Print(name + " is listening on port " + port.ToStr()));
    ToSync(prospect);
}

/// Handler function for the `/hello` endpoint.
async function Greeting(request: Request): ServerOutcome {
    return Ok(
        *Response 
            .From(request)
            .Status(200)
            .Html("<h1>Hello, world!</h1>")
    );
}

async function CreateUser(): ServerOutcome {
    return Todo();
}