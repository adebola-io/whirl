module memory;

use core.{
    primitives.{UInt8, UnsignedInt},
    prelude.{
        Iteratable, none, some, Display, 
        String, todo, Bool
    },
};

/// Swaps the address of two values.
/// # Usage
/// ```
/// use core.memory.wwap;
/// 
/// a := 9;
/// b := 12;
/// swap(a, b);
/// 
/// assert(a).equals(12);
/// assert(b).equals(9);
/// ```
public function swap<T>(a: T, b: T) {
    temp := a;
    a = b;
    b = temp;
}

/// A weak reference 
public model WeakRef<T> {
    var reference: T;
    var exists: Bool;
    /// Retrieves the value in the reference.
    public function value(): ?T {
        if this.exists {
            return some(this.reference);
        } else none()
    }
}


public model Buffer implements Iteratable<UInt8> + Display {
    var values: []UInt8;
    var idx: UnsignedInt;

    new(values: []UInt8) {
        this.values = values;
        this.idx = 0;
    }

    public function [Iteratable.next](): ?UInt8 {
        if this.idx == this.values.length() {
            return none();
        };
        nextByte := this.values[this.idx];
        this.idx += 1;
        return some(nextByte);
    }

    public function [Display.toStr](): String {
        return todo();
    }
}